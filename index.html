<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>충훈고등학교 급식충</title>
    <style>
      body {
        background-image: url("https://example.com/background-image.jpg");
      }
      .container {
        max-width: 800px;
        margin: 0 auto;
        border-top: 40px solid black;
        border-bottom: 40px solid black;
        padding: 200px;
        background-color: rgb(255, 255, 255);
        border-radius: 10px;
      }
      #mealInfo {
        resize: none;
      }
      .invalid-date {
        border: 2px solid red;
      }
    </style>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
      function loadMealInfo() {
        const schoolCode = "7530626"; // 학교 코드
        const date = $("#date").val().replace(/-/g, ""); // 날짜
        const mealType = "2"; // 급식 종류 (중식)

        const url = `https://open.neis.go.kr/hub/mealServiceDietInfo?ATPT_OFCDC_SC_CODE=J10&SD_SCHUL_CODE=${schoolCode}&MLSV_YMD=${date}&MMEAL_SC_CODE=${mealType}&Type=json`;

        $.ajax({
          url: url,
          type: "GET",
          dataType: "jsonp",
          jsonp: "callback",
          success: function (data) {
            if (data.mealServiceDietInfo[1].row.length === 0) {
              alert("급식 정보가 존재하지 않습니다.");
              return;
            }
            const menu = data.mealServiceDietInfo[1].row[0].DDISH_NM.replaceAll("<br/>", "\n");
            $("#mealInfo").val(menu);
          },
          error: function (xhr, status, error) {
            console.error(xhr);
            console.error(status);
            console.error(error);
            alert("데이터를 불러오는 중 오류가 발생했습니다.");
          },
        });
      }

      $(document).ready(function () {
        const now = new Date();
        const today = new Date(now.getFullYear(), now.getMonth(), now.getDate()).toISOString().split("T")[0];
        const saturday = new Date(now.getFullYear(), now.getMonth(), now.getDate() - now.getDay() + 6).toISOString().split("T")[0];
        const sunday = new Date(now.getFullYear(), now.getMonth(), now.getDate() - now.getDay()).toISOString().split("T")[0];

        $("#date").attr("min", sunday);
        $("#date").attr("max", saturday);

        $("#date").on("change", function () {
          const selectedDate = new Date($(this).val());
          if (selectedDate.getDay() === 0) {
            $(this).addClass("invalid-date");
            alert("일요일은 선택할 수 없습니다.");
          } else if (selectedDate.getDay() === 6) {
            $(this).addClass("invalid-date");
            alert("토요일은 선택할 수 없습니다.");
          } else {
            $(this).removeClass("invalid-date");
          }
        });
      });
    </script>
  </head>
  <body>
    <div class="container">
      <div id="logo"></div>
      <h1>충훈고 급식 정보</h1>
      <label for="date">날짜:</label>
      <input type="date" id="date" value="" /><br /><br />
      <label for="mealType">급식 종류:</label>
      <select id="mealType">
        <option value="2">중식</option>
      </select>
      <br /><br />
      <button type="button" onclick="loadMealInfo()">불러오기</button>
      <br /><br />
      <textarea id="mealInfo" rows="10" cols="50"></textarea>
    </div>
  </body>
</html>

